<!DOCTYPE html>
<html>
<head>
    <title>TS-Tool-Multiple-Axis</title>
    <!-- Javascript -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="javascript/highstock-6.1.4.js"></script>
    <script src="javascript/data.js"></script>

</head>

<body>
    <div id="container" style="min-width:300px; max-width: 1200px; height:600px;">

        <script>
            var configFile = "../data-files/config1.json";



            var myChart;
            $.ajax({
                url: configFile,
                async: false,
                dataType: 'json',
                error: function(error){
                    console.log('issue')
                },
                success: function(data){
                    console.log(data)
                    
                    $(function(){
                        //read json configuration properties
                        Highcharts.setOptions(data.Properties);
                        
                        //load data name into variable
                        var dataFile = "data-prep/4710-wind.csv";

                        // jQuery command to get/read file from csv
                        $.get(dataFile, function(csvData) {
                        	myChart = Highcharts.chart('container', {
                                data: {
                          			csv: csvData    // data to be plotted
                        		}
                        	});


                            //perform the request for sunrise/sunset data
                            var day;
                            for (day = 1; day < 11; day++){

                                var sunrise = "https://api.sunrise-sunset.org/json?lat=36.7201600&lng=-4.4203400&date=2016-1-" + day + "&formatted=0";

                                $.ajax({
                                    url: sunrise,
                                    async: false,
                                    dataType: 'json',
                                    error: function(error){
                                        console.log('issue')
                                        //loop to add plot bands for day/night cycles (default 7am-7pm)
                                        myChart.xAxis[0].addPlotBand({
                                            from: Date.UTC(2016,0,day,7),
                                            to: Date.UTC(2016,0,day,19),
                                            color: '#FCFFC5'
                                        });  
                                    },
                                    success: function(data){
                                        if (data.status != "OK"){
                                            console.log('data.status is not OK')
                                            //loop to add plot bands for day/night cycles (default 7am-7pm)
                                            myChart.xAxis[0].addPlotBand({
                                                from: Date.UTC(2016,0,day,7),
                                                to: Date.UTC(2016,0,day,19),
                                                color: '#FCFFC5'
                                            });
                                        }
                                        else {

                                            var mySunrise = data.results.sunrise.substring(
                                                data.results.sunrise.indexOf("T") + 1, 
                                                data.results.sunrise.indexOf("+")
                                            );
                                            console.log(mySunrise);

                                            var times = mySunrise.split(':')//////////////////////////////////////////////////////////////

                                            console.log(times[0])

                                            myChart.xAxis[0].addPlotBand({
                                                from: Date.UTC(2016,0,day,times[0],times[1],times[2]),
                                                to: Date.UTC(2016,0,day,times[0],times[1],times[2]),
                                                color: '#FCFFC5'
                                            }); 
                                        }

                                    }
                                })
                            }


                            
                            //update properties that depend on data
                            myChart.update(data.Properties);

                        });
                    });
                }
            })

        </script>
    </div>
</body>

</html>

